# 3D Моделирование Человека для Виртуальной Примерки Одежды

Проект предназначен для создания 3D-моделей человека, которые используются для виртуальной примерки одежды. Система объединяет несколько модулей, каждый из которых выполняет свою задачу:  
- **scaling-skeleton** — получение и масштабирование скелета человека с использованием данных OpenPose  
- **glb-measurement** — измерение ключевых параметров модели (например, окружности бедер, ширины плеч) на основе 3D-модели  
- **blender-models-combine** — автоматизированное совмещение 3D-модели с позой, полученной из OpenPose, в Blender

Эти модули работают вместе, формируя единый рабочий процесс для точного 3D-моделирования и измерений, необходимых для виртуальной примерки одежды.

---

## Содержание

- [Обзор](#обзор)
- [Структура Проекта](#структура-проекта)
- [Требования](#требования)
- [Установка и Запуск](#установка-и-запуск)
- [Описание Модулей](#описание-модулей)
  - [scaling-skeleton](#scaling-skeleton)
  - [glb-measurement](#glb-measurement)
  - [blender-models-combine](#blender-models-combine)
- [Интеграция Модулей](#интеграция-модулей)
- [Планы по Развитию](#планы-по-развитию)

---

## Обзор

Проект представляет собой комплексное решение для создания 3D моделей человека на основе фотографий. Система использует OpenPose для получения ключевых точек скелета, а затем:
- Масштабирует скелет до соответствия реальной высоте человека,
- Проводит измерения параметров модели (например, окружность бедер, ширину плеч),
- Совмещает 3D модель с полученной позой для последующей визуализации и использования в виртуальной примерке одежды.

Данный подход позволяет добиться высокой точности измерений и корректного отображения модели в 3D-пространстве, что является критически важным для онлайн-магазинов одежды.

---

## Структура Проекта

```
/project-root
│
├── scaling-skeleton
│   └── readme.md          # Подробное описание процесса получения и масштабирования скелета
│
├── glb-measurement
│   ├── readme.md          # Инструкции по измерению параметров 3D модели
│   ├── perfect_hip_measurement.ipynb
│   └── evaluate_shoulder_width.ipynb
│
└── blender-models-combine
    └── readme.md          # Инструкции по совмещению 3D модели с позой в Blender
```

---

## Требования

Для работы проекта потребуются:
- **Python** (рекомендуется версия 3.7 или выше)
- **Blender** с поддержкой Python API (bpy)
- **OpenPose** для получения данных скелета
- Библиотеки для работы с 3D моделями (например, `manifold`, `matplotlib`, и др.)
- Дополнительные зависимости, указанные в каждом модуле

---

## Установка и Запуск

### Общая установка:
1. **Клонирование репозитория**  
   ```bash
   git clone https://github.com/LessVegetables/ml.git
   cd ml
   ```

2. **Установка зависимостей**  
   Убедитесь, что установлены все требуемые зависимости для каждого модуля. Рекомендуется использовать виртуальное окружение:
   ```bash
   python -m venv venv
   source venv/bin/activate  # для Linux/Mac
   venv\Scripts\activate     # для Windows
   pip install -r requirements.txt
   ```

3. **Настройка Blender и OpenPose**  
   Установите и настройте Blender для работы со скриптами и установите OpenPose согласно официальной документации.

### Запуск модулей

На данный момент, каждый модуль запускается независимо в своем контексте:

- **scaling-skeleton:**  
  Запустите скрипт для обработки JSON-файла с ключевыми точками, полученными от OpenPose. Результатом будет масштабированный и центрированный скелет.  
  *Инструкции по запуску и параметры можно найти в [scaling-skeleton/readme.md](./scaling-skeleton/README.md).*

- **glb-measurement:**  
  Модуль содержит два процесса:  
  - **perfect_hip_measurement:** Измерение окружности бедер с использованием слайсов 3D модели.  
  - **evaluate_shoulder_width:** Оценка ширины плеч.  
  *Подробные инструкции – см. [glb-measurement/readme.md](./glb-measurement/README.md).*

- **blender-models-combine:**  
  Этот скрипт для Blender объединяет 3D модель (GLB-файл) с позой, полученной из OpenPose. Он выполняет масштабирование, центрирование и совмещение модели.  
  *Детали работы описаны в [blender-models-combine/readme.md](./blender-models-combine/README.md).*

---

## Описание Модулей

### scaling-skeleton

**Цель:**  
Получить скелет человека с использованием OpenPose, масштабировать его и привести к масштабу 3D модели.

**Основные шаги:**
1. Запуск OpenPose для получения снимков с ключевыми точками.
2. Чтение JSON-файла с ключевыми точками.
3. Центрирование и масштабирование скелета.
4. Смещение скелета в центр 3D модели.

**Детали:**  
Смотрите [scaling-skeleton/readme.md](./scaling-skeleton/README.md) для подробного описания.

---

### glb-measurement

**Цель:**  
Проверить корректность работы модели по построению 3D модели на основе одного фото, а также произвести точные измерения (например, окружности бедер и ширины плеч).

**Основные процессы:**
- **perfect_hip_measurement:**  
  - Загрузка и масштабирование 3D модели.
  - Разбиение модели на слайсы.
  - Извлечение и фильтрация контура бедер.
  - Визуализация и расчет периметра, соответствующего окружности бедер.
  
- **evaluate_shoulder_width:**  
  - Разбиение модели для выделения области плеч.
  - Поиск слайса с максимальной шириной, что соответствует ширине плеч.

**Детали:**  
Подробности см. в файлах [perfect_hip_measurement.ipynb](./glb-measurement/perfect_hip_measurement.ipynb) и [evaluate_shoulder_width.ipynb](./glb-measurement/evaluate_shoulder_width.ipynb).

---

### blender-models-combine

**Цель:**  
Автоматизировать процесс совмещения 3D модели человека (GLB-файл) с позой, полученной из OpenPose.

**Основные шаги:**
1. Загрузка JSON с данными ключевых точек.
2. Фильтрация и преобразование координат ключевых точек в 3D.
3. Создание объектов Empty в Blender для визуализации суставов.
4. Создание скелета на основе стандартной схемы (COCO).
5. Загрузка GLB-модели человека и определение её bounding box.
6. Вычисление масштабирующего коэффициента и центрирование модели.
7. Совмещение модели с позой, полученной из OpenPose.

**Детали:**  
Смотрите [blender-models-combine/readme.md](./blender-models-combine/README.md) для полного описания работы скрипта.

---

## Интеграция Модулей

В рамках общего процесса 3D моделирования для виртуальной примерки одежды модули интегрируются следующим образом:

1. **Получение и масштабирование скелета (scaling-skeleton):**  
   - OpenPose обрабатывает исходное фото, и скрипт из scaling-skeleton масштабирует и центрирует полученные ключевые точки.

2. **Измерения модели (glb-measurement):**  
   - На основе предварительно масштабированной 3D модели выполняются измерения, необходимые для определения точных параметров (окружность бедер, ширина плеч), что важно для подбора одежды.

3. **Совмещение модели с позой (blender-models-combine):**  
   - После измерений и корректировки, 3D модель совмещается с полученной позой, что позволяет визуализировать модель в точном соответствии с реальными размерами и положением.


---

## Планы по Развитию

- **Улучшение точности измерений:**
  Доработка алгоритмов для ещё более точного определения параметров тела, что повысит качество конечной 3D модели.
- **Красивая обертка:**
  Упаковка всех модулей в webapp для удобного использования и интеграции в онлайн-магазины. Обработка и детекция будут выполняться на сервере, а клиенту возвращается уже готовая 3D модель, что улучшает производительность и пользовательский опыт.
